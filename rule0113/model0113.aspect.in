@include "../ldv.aspect"

before: file("$this")
{

#define const

extern void ldv_check( void );
}

new: file(LDV_COMMON_MODEL)
{

#include <ldv.h>

extern int LDV_IN_INTERRUPT;

void
ldv_check( void )
{
   ldv_assert( LDV_IN_INTERRUPT == 1 );
}

}

around: define(on_each_cpu(func,info,wait))
{
   ({ ldv_check(); 0; })
}

after: call(int on_each_cpu(..))
{
   ldv_check();
}

around: define( local_irq_enable() )
{
   ldv_check()
}


